
  
  
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
   
<div class="row mt-5 mb-5 mx-3" style="margin-top:25px ;">
  <div class="col-md-3">
    <div style="margin-top: 50px; margin-left: 10px;" class="text-center">
      <i id="animationDemo" data-mdb-animation="slide-right" data-mdb-toggle="animation" data-mdb-animation-reset="true"
        data-mdb-animation-start="onScroll" data-mdb-animation-on-scroll="repeat"
        class="fas fa-3x fa-shipping-fast text-dark"></i>
      <h3 class="mt-3 text-dark">Welcome</h3>
      <p class="white-dark">You are 30 seconds away from completing your Delivery details!</p>
    </div>



  </div>
  <div class="col-md-9 justify-content-center">
    <div class="card card-custom pb-4">
      <div class="card-body mt-0 mx-5">
        <div class="text-center mb-3 pb-2 mt-3">
          <h4 style="color: #495057 ;">Delivery Details</h4>
        </div>

        <form action="" id="addon">

          <div class="row mb-4">
            <div class="col">
              <div class="form-outline">
                <input type="text" id="form9Example1" name="firstname" class="form-control input-custom" />
                <label class="form-label" for="form9Example1">First name</label>
              </div>
            </div>
            <div class="col">
              <div class="form-outline">
                <input type="text" id="form9Example2" name="lastname" class="form-control input-custom" />
                <label class="form-label" for="form9Example2">Last name</label>
              </div>
            </div>
          </div>
          <div class="row mb-4">
            <div class="col">
              <div class="form-outline">
                <input type="text" id="form9Example3" name="city" class="form-control input-custom" />
                <label class="form-label" for="form9Example3">City</label>
              </div>
            </div>
            <div class="col">
              <div class="form-outline">
                <input type="text" id="form9Example4" name="zip" class="form-control input-custom" />
                <label class="form-label" for="form9Example4">Zip</label>
              </div>
            </div>
          </div>
          <div class="row mb-4">
            <div class="col">
              <div class="form-outline">
                <input type="text" id="form9Example6" name="address" class="form-control input-custom" />
                <label class="form-label" for="form9Example6">Address</label>
              </div>
            </div>
            <div class="col">
              <div class="form-outline">
                <input type="email" id="typeEmail" name="email" class="form-control input-custom" />
                <label class="form-label" for="typeEmail">Email</label>
              </div>
            </div>
          </div>
          <div class="row mb-4">
            <div class="col-3">
              <div class="form-outline">
                <input type="text" id="form9Example6" name="State" class="form-control input-custom" />
                <label class="form-label" for="form9Example6">State</label>
              </div>
            </div>

          </div>
                <div class="row mb-4">
            <div class="col-3">
              <div class="form-outline">
                <input type="text" id="form9Example6" name="mobile" class="form-control input-custom" />
                <label class="form-label" for="form9Example6">Mobile</label>
              </div>
            </div>

          </div>

          <div class="float-end ">
            <!-- Submit button -->
            <button type="submit" class="btn btn-primary btn-rounded" style="background-color: #0062CC ;">Add New
              Address</button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>


    </div>
  </div>
</div>
  
<div class="container  pt-3" style="background-image: linear-gradient( 110.1deg,  rgba(34,126,34,1) 2.9%, rgb(34, 36, 31) 90.3% );box-shadow: 2px 3px 3px 3px; "  >

  
 
  <div class="col"><h2>Your Addresses</h2></div>

<div class=" m-0 row ">


  {{#each addresscame}}
  
  <div class="col-md-4">
    <div class="form-check">
     
       
    <input class="form-check-input" value="{{this.id}}" type="radio" name="addressradio" id="flexRadioDefault1">
    <label class="form-check-label" for="flexRadioDefault1">
      Selected
    </label>
     <button class="btn btn-danger float-end" onclick=" deleteaddress('{{this.id}}')" type="submit" style="font-size:x-small;"><i class="fa-solid fa-trash-can"></i></button>
  </div>
  <div class="card my-4 ml-2 shadow-3" style="border-radius:19px;">


    <div class="card-body  p-md-5 text-black">
      <h3 class="mb-4 text-uppercase">Delivery Info</h3>

      <p name="firstname">{{this.firstname}}  </p>
      <p name="lastname">{{this.lastname}}</p>

      <p name="city">{{this.city}}</p>
      <p name="address">{{this.address}}</p>
      <p name="zip"  >{{this.zip}}</p>
      <p name="number">{{this.mobile}}</p>



    </div>


  </div>
  </div>
  {{/each }}
</div>


<button type="button" class="btn border bg-dark text-white bg-gradient mb-2 ml-lg-5" data-toggle="modal" data-target=".bd-example-modal-lg"> Click here to  Add a new Address +</button>

<div class="text-white" >
  
  <h2 class="ml-lg-5">Select Your Payment Method</h2>
</div>

  <div class="payment ml-5"  style="font-size:20px ; font-family: cursive; color: antiquewhite;" >
    <p class="">payment method</p>
    <label class="radio-inline" >
      <input type="radio" required name="paymentmethod" value="COD" checked >COD <i class="fa-solid fa-sack-dollar"></i>
    </label><br>
        <label class="radio-inline" >
      <input type="radio" name="paymentmethod" required value="RAZERPAY" checked >Razerpay <i class="fa-regular fa-credit-card"></i>
    </label> <br>
        <label class="radio-inline" >
      <input type="radio" name="paymentmethod" required value="PAYPAL" checked >Paypal <i class="fa-regular fa-credit-card"></i>
    </label><br>

    {{#if walletbalance}}
     <label class="radio-inline" >
      <input type="radio" name="paymentmethod" required value="WALLET" checked > wallet <i class="fa-regular fa-credit-card"></i>
    </label>
    {{else}}
     <label class="radio-inline" >
      <input type="radio" disabled name="paymentmethod" required value="PAYPAL" checked > Wallet <i class="fa-solid fa-wallet"></i>
      <p class="text-danger" style="font-size:15px ;">Wallet Balance is  Insufficient...! <i class="fa-solid fa-face-frown"></i></p>
    </label>
    {{/if}}

    
  </label><br>
        


  </div>




 <div class="col-md-12 pb-4">
        <div class="card mb-4">
          <div class="card-header py-3 bg-gradient " style="background-color:RGB(39, 83, 29) ;" >
            <h5 class="mb-0">Summary</h5>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li
                class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                Products
                <span style="font-size:x-large  ; font-family:'Times New Roman', Times, serif ;" >₹{{total}}</span>
              </li>
              <li
                class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-0">
                More offers
                <span style="font-size:x-large   ; font-family:'Times New Roman', Times, serif ;" >{{#if newprice}}<button type="button" class="btn text-danger   p-0 " data-toggle="modal" data-target=".bd-example-modal-lg2" style="font-size:18px;">Coupen Applied:-₹{{newprice.offerprice}}</button> {{else}}<button type="button" class="btn p-0 "  data-toggle="modal" data-target=".bd-example-modal-lg2" style="font-size:18px; font-weight: 600;" >Apply Coupen</button>{{/if}}</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center px-0">
               Coupen Offer 
             <span>-₹<span id="offerapplied" style="font-size:x-large  ; font-family:'Times New Roman', Times, serif ;" >0.00</span>
              </span>  </li>
              <li class="list-group-item d-flex justify-content-between align-items-center px-0">
               Free Shipping
                <span style="font-size:x-large  ; font-family:'Times New Roman', Times, serif ;" >₹0.00</span>
              </li>
              <li
                class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 mb-3">
                <div>
                  <strong>Total amount</strong>
                  <strong>
                    <p class="mb-0">(including VAT)</p>
                  </strong>
                </div>
               
                {{!-- <span style="font-size:xx-large  ; font-family:'Times New Roman', Times, serif ;" ><strong>₹{{newprice.Retotal}}</strong></span>
                 --}}
                <span style="font-size:xx-large  ; font-family:'Times New Roman', Times, serif ;">₹<span id="newprice" style="font-size:xx-large  ; font-family:'Times New Roman', Times, serif ;" ><strong>{{total}}</strong></span>
                </span>
              </li>
            </ul>

            <button type="submit" onclick="procedToPayment()" class="btn btn-primary btn-lg btn-block" style="background-color:RGB(39, 83, 29) ;">
              Confirm ORDER
            </button>
          </div>
        </div>
      </div>
      
    
       <div class="card mb-4 mb-lg-0 p-0">
          <div class="card-body py-0  bg-gradient">
            <p><strong>We accept</strong></p>
            <img class="me-2" width="45px"
              src="https://mdbcdn.b-cdn.net/wp-content/plugins/woocommerce-gateway-stripe/assets/images/visa.svg"
              alt="Visa" />
            <img class="me-2" width="45px"
              src="https://mdbcdn.b-cdn.net/wp-content/plugins/woocommerce-gateway-stripe/assets/images/amex.svg"
              alt="American Express" />
            <img class="me-2" width="45px"
              src="https://mdbcdn.b-cdn.net/wp-content/plugins/woocommerce-gateway-stripe/assets/images/mastercard.svg"
              alt="Mastercard" />
               <img class="me-2" width="65px"
              src="data:image/png;base64,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"
              alt="COD" />
           
          </div>
        </div>
    </div>
  </div>
</section>
</div>
</ >

</div>


<input type="text" id="newprice2" value="" hidden>

<div class="modal fade bd-example-modal-lg2" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel2" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      {{#each coupens}}
      <div class="col-7 " style="font-family: cursive; " >
        <p class="m-2" >Coupen code: {{this.coupen}} <br> {{this.offer}}% offer for a min purchase of {{Min_Amount}}</p><br>
      
      </div>
      <div class="col-3 justify-content-center m-2 p-4">
        <button class="btn" value="{{this._id}}" id="coupenid" onclick="applycoupen('{{this._id}}')" >Apply Coupen</button>
      </div>
       {{/each}}
    </div>
  </div>
</div>


<script>

function applycoupen(coupenid){
  console.log('908')
  $.ajax({
   url:('/applycoupen'),
   data:{
    coupenid:coupenid
   },method:"post",
   success:(response)=>{
    console.log(response)
    console.log(response.Retotal)
     document.getElementById('newprice').innerHTML=response.Retotal 
        document.getElementById('newprice2').value=response.coupenid
        document.getElementById('offerapplied').innerHTML=response.offerprice
        
        alertifyco()
      
   }



  })
}  function alertifyco (){
   alertify.set('notifier','position', 'top-right');
 alertify.error('Coupen  Applied Successfully ');
} 



 function hlo(){
    return new Promise(async(resolve,reject)=>{
     
    }).then(()=>{
      location.reload()
    })
    

  }



</script>







<script >

$("#checkoutform").submit((e)=>{
  e.preventDefault()
  console.log("ivide aayi")
  
   $.ajax({
  
  url:'/placeorder',
  method:'post',
  data:$('#checkoutform').serialize(),
  success:(response)=>{
     alert(response)
     if(response.codSuccess){
 window.location = "/ordersuccess";
     }else if(response.paypalsuccess){
      location.replace(response.directionlink)
     }
     
     else{
      console.log("ivide ethiii")
       razorpaypayment(response)
       
     }



  }
})

})











function procedToPayment(){
   console.log("sets sadhanam")
            addressradio=document.querySelector('input[name="addressradio"]:checked').value
            paymentmethod=document.querySelector('input[name="paymentmethod"]:checked').value
            coupenid=document.getElementById('newprice2').value
            console.log(coupenid,"90")
            $.ajax({
           
              
            url:'/placeorderbyselectingaddress',                                                                                                   
            data:{
                addressradio:addressradio,  
                paymentmethod:paymentmethod,
                coupenid:coupenid
            },
            method: 'post',
            success:(response)=>{
                console.log('Reached')
                console.log(response)
                if(response.codSuccess){
                 location.href='/ordersuccess'  
                }else if(response.walletused){
                  location.href='/ordersuccess'
                }
                
                else if (response.razorpaysuccess){
                   console.log("ivide ethiii")
       razorpaypayment(response)

                }else if(response.paypalsuccess){
                  console.log("joli")
                  location.replace(response.directionlink)
                  {{!-- paypalstatus(response.orderid) --}}

                }
                 
            }
})
}


function razorpaypayment(order){
  console.log("order script:")
  var options = {
    "key": "rzp_test_wdsDxzRwb6eQj9", // Enter the Key ID generated from the Dashboard
    "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "Acme Corp",
    "description": "Test Transaction",
    "image": "https://example.com/your_logo",
    "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
   "handler": function (response){    // --Success handling code
       // alert(response.razorpay_payment_id);
        //alert(response.razorpay_order_id);
        //alert(response.razorpay_signature)

        verifyPayment(response,order)
    },
    "callback_url": "https://eneqd3r9zrjok.x.pipedream.net/",
    "prefill": {
        "name": "Gaurav Kumar",
        "email": "gaurav.kumar@example.com",
        "contact": "9999999999"
    },
    "notes": {
        "address": "Razorpay Corporate Office"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp1 = new Razorpay(options);
   rzp1.open();

}



 function verifyPayment(payment,order){
    $.ajax({
      url:'/verify-payment',
      data:{
        payment,
        order
      },
      method:'post',
      success:(response)=>{
        if(response.status){
          location.href='/ordersuccess'
        }else{
          alert("Payment Failed ! ")
        }
      }
    })
  }





  $("#addon").submit((e) => {
    e.preventDefault()
    console.log("ivide aayi")

    $.ajax({

      url: '/addnewaddress',
      method: 'post',
      data: $('#addon').serialize(),
      success: (response) => {

        location.reload()

      }
    })

  })
  
  function deleteaddress(uid){
    console.log("89")
    $.ajax({
         url:('/delete-address/'),
         data:{
          id:uid
         },
         method:'post',
         success:(response)=>{
          alert("success")
          location.reload()
         }


    })
  }



</script>
